<!-- themes/lens/layout/archive.ejs -->
<div class="archive-container" style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">
  
  <% var lastYear; %>

  <% /* 先统计每年的文章数量，用于在年份标题后显示合计 */ %>
  <% var counts = {}; %>
  <% site.posts.each(function(p){ %>
    <% var y = p.date.year(); %>
    <% counts[y] = (counts[y] || 0) + 1; %>
  <% }); %>

  <% page.posts.each(function(post){ %>
    <% var currentYear = post.date.year(); %>
    
    <!-- 如果年份变化，显示年份标题 -->
    <% if (lastYear !== currentYear) { %>
      <h2 class="archive-year-header" style="margin: 3rem 0 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.8rem; color: #333;">
        <%= currentYear %>
        <span class="archive-year-count" style="font-size:0.95rem; color:#666; margin-left:10px;">（合计 <%= counts[currentYear] %> 篇）</span>
      </h2>
      <% lastYear = currentYear; %>
    <% } %>

    <!-- 文章列表项：日期与标题均可点击，悬浮在日期上时标题出现跳动效果 -->
    <div class="archive-item" style="display: flex; align-items: baseline; margin-bottom: 1rem;">
      <a href="<%- url_for(post.path) %>" class="archive-date" style="min-width: 80px; color: #999; font-family: monospace; font-size: 0.95rem; text-decoration: none; cursor: pointer;">
        <%= date(post.date, 'MM-DD') %>
      </a>
      <a href="<%- url_for(post.path) %>" class="archive-link" style="font-size: 1.1rem; color: #333; text-decoration: none; border-bottom: 1px dashed #ccc; margin-left: 0.6rem;">
        <%= post.title %>
      </a>
    </div>
  <% }) %>

  <!-- 归档页的分页器 -->
  <nav class="pagination" style="margin-top: 3rem;">
    <%- paginator({
      prev_text: '&laquo; Prev',
      next_text: 'Next &raquo;'
    }) %>
  </nav>
</div>

<!-- 简单的 CSS 悬停与跳动效果：当悬浮在日期时，标题也会跳动 -->
<style>
  .archive-link {
    display: inline-block;
    transition: transform 180ms cubic-bezier(.2,.8,.2,1), color 120ms ease;
  }

  .archive-date {
    text-decoration: none;
    color: #999;
    cursor: pointer;
    transition: color 120ms ease;
  }

  /* 标题自身悬浮效果 */
  .archive-link:hover {
    color: var(--accent-color, #0078d4) !important;
    border-bottom-style: solid !important;
    transform: translateY(-4px);
  }

  /* 当鼠标悬浮在日期上，使相邻的标题产生相同的跳动效果 */
  .archive-date:hover + .archive-link {
    color: var(--accent-color, #0078d4) !important;
    border-bottom-style: solid !important;
    transform: translateY(-4px);
  }
</style>